(function(){var DateRound,UnitError,method,name,singularize,timeMethod,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;DateRound={};singularize=function(str){return str.replace(/s$/,"")};UnitError=function(superClass){extend(UnitError,superClass);function UnitError(unit){this.name="DateRound.UnitError";this.message="Unknown unit "+unit;this.stack=(new Error).stack}return UnitError}(Error);DateRound.UnitError=UnitError;DateRound.add=function(date,value,unit){date=new Date(date);switch(singularize(unit)){case"millisecond":date.setUTCMilliseconds(date.getUTCMilliseconds()+value);break;case"second":date.setUTCSeconds(date.getUTCSeconds()+value);break;case"minute":date.setUTCMinutes(date.getUTCMinutes()+value);break;case"hour":date.setUTCHours(date.getUTCHours()+value);break;case"day":date.setUTCDate(date.getUTCDate()+value);break;case"week":date.setUTCDate(date.getUTCDate()+value*7);break;case"month":date.setUTCMonth(date.getUTCMonth()+value);break;case"year":date.setUTCFullYear(date.getUTCFullYear()+value);break;default:throw new UnitError(unit)}return date};DateRound.subtract=function(date,value,unit){return DateRound.add(date,value*-1,unit)};DateRound.floor=function(date,unit){var dow,snit;date=new Date(date);snit=singularize(unit);if(snit!=="millisecond"){date.setUTCMilliseconds(0);if(snit!=="second"){date.setUTCSeconds(0);if(snit!=="minute"){date.setUTCMinutes(0);if(snit!=="hour"){date.setUTCHours(0);if(snit==="week"){dow=(date.getUTCDay()+6)%7;date.setUTCDate(date.getUTCDate()-dow)}else if(snit!=="day"){date.setUTCDate(1);if(snit==="year"){date.setUTCMonth(0)}else if(snit!=="month"){throw new UnitError(unit)}}}}}}return date};DateRound.ceiling=function(date,unit){var floor;date=new Date(date);floor=DateRound.floor(date,unit);if(date.getTime()===floor.getTime()){return date}else{return DateRound.add(floor,1,unit)}};DateRound.round=function(date,unit){var ceiling,ceilingDiff,floor,floorDiff;date=new Date(date);ceiling=DateRound.ceiling(date,unit);floor=DateRound.floor(date,unit);ceilingDiff=ceiling.getTime()-date.getTime();floorDiff=date.getTime()-floor.getTime();if(ceilingDiff>floorDiff){return floor}else{return ceiling}};timeMethod=function(f){return function(){return f.apply(this,arguments).getTime()}};for(name in DateRound){method=DateRound[name];DateRound[name+"Time"]=timeMethod(method)}module.exports=DateRound}).call(this);